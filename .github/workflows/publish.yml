name: ğŸ“¡ Veri GÃ¼ncelleme ve YayÄ±nlama

on:
  schedule:
    - cron: "*/3 * * * *"  # Her 3 dakikada bir Ã§alÄ±ÅŸÄ±r
  workflow_dispatch:

jobs:
  update-and-publish:
    runs-on: ubuntu-latest

    steps:
      - name: â¬‡ï¸ Repo'yu klonla
        uses: actions/checkout@v3

      - name: ğŸŸ¢ Node kur
        uses: actions/setup-node@v3
        with:
          node-version: 20

      - name: ğŸ“¦ Gerekli paketleri kur
        run: npm install node-fetch node-html-parser

      - name: ğŸ“ API klasÃ¶rÃ¼nÃ¼ oluÅŸtur
        run: mkdir -p api

      - name: ğŸŒ AFAD verisini gÃ¼ncelle
        run: node scripts/afad.js

      - name: ğŸ›ï¸ BoÄŸaziÃ§i verisini gÃ¼ncelle
        run: node scripts/boun.js

      - name: ğŸŒ USGS verisini gÃ¼ncelle
        run: node scripts/usgs.js

      - name: ğŸ”„ Git ayarlarÄ±
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

      - name: ğŸ’¾ DeÄŸiÅŸiklikleri commit et
        run: |
          git add api/
          git commit -m "ğŸ“¦ Veri gÃ¼ncellendi: $(date '+%Y-%m-%d %H:%M:%S')" || echo "DeÄŸiÅŸiklik yok"

      - name: ğŸš€ Push iÅŸlemi
        run: git push --force "https://erhanaydin:${{ secrets.GH_PAT }}@github.com/erhanaydin/sondepremler-api-work.git" main
